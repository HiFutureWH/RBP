<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Structure Gallery</title>

  <!-- Mol* (PDBe 发行版) -->
  <script src="https://cdn.jsdelivr.net/npm/pdbe-molstar@latest/build/pdbe-molstar-plugin.js"></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pdbe-molstar@latest/build/pdbe-molstar.css"/>

  <style>
    :root { --thumb-height: 380px; }      /* 每个视窗高度，可自行调整 */
    *{box-sizing:border-box}
    body{margin:0;font-family:sans-serif;height:100vh;display:flex;flex-direction:column}
    h1{margin:10px 16px}
    #grid{
      flex:1;
      overflow:auto;
      display:grid;
      gap:12px;
      padding:12px 16px 24px;
      /* 自动排版：最小宽 400px，每行塞下若干列 */
      grid-template-columns:repeat(auto-fill,minmax(400px,1fr));
    }
    .viewer-box{
      width:100%;
      height:var(--thumb-height);
      border:1px solid #ddd;
      border-radius:6px;
    }
  </style>
</head>

<body>
  <h1>Structure Gallery</h1>
  <div id="grid"></div>

  <script>
    /* === 路径常量，按需替换 === */
    const CSV_URL  = 'https://raw.githubusercontent.com/HiFutureWH/RBP/main/list/File_Name_List.csv';
    const BASE_URL = 'https://raw.githubusercontent.com/HiFutureWH/RBP/main/interaction_structures/';
    // 若你已把 interaction_structures/ 拷到 GitHub Pages，也可用：
    // const BASE_URL = 'https://hifuturewh.github.io/RBP/interaction_structures/';

    /** 读取 CSV → 提取文件名 → 逐个渲染 */
    fetch(CSV_URL)
      .then(r => {
        if (!r.ok) throw new Error(`CSV download failed: ${r.status}`);
        return r.text();
      })
      .then(text => {
        /* 跳过首行 header，按换行分割 */
        const files = text.trim().split(/\r?\n/).slice(1).filter(Boolean);
        if (!files.length) { alert('CSV 中未找到任何 .cif 文件'); return; }

        const grid = document.getElementById('grid');

        files.forEach((name, i) => {
          const box = document.createElement('div');
          box.id = `viewer-${i}`;
          box.className = 'viewer-box';
          grid.appendChild(box);

          const viewer = new PDBeMolstarPlugin();
          viewer.render(box.id, {
            customData: { url: BASE_URL + encodeURIComponent(name), format: 'cif' },
            ui: true
          });
        });
      })
      .catch(err => {
        console.error(err);
        alert('加载文件列表或结构数据时出错，请检查控制台日志');
      });
  </script>
</body>
</html>
