<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Structure + Sequence Gallery</title>
  <style>
    :root { --view-h: 360px; --view-w: 420px; }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:sans-serif}
    h1{margin:16px}

    #grid{
      display:flex;
      flex-direction:column;
      gap:20px;
      padding:0 16px 32px;
    }
    .row{
      display:flex;
      gap:16px;
      align-items:flex-start;
      border:1px solid #ddd;
      border-radius:6px;
      padding:10px;
    }
    .id-tag{
      font:14px/1.2 monospace;
      padding:6px 8px;
      background:#e9eef6;
      border:1px solid #cbd6e2;
      border-radius:4px;
      flex-shrink:0;
      max-width:90px;
      word-break:break-all;
      text-align:center;
    }
    iframe{
      width:var(--view-w);
      height:var(--view-h);
      border:0;
      flex-shrink:0;
    }
    .seq-box{
      flex:1;
      max-height:var(--view-h);
      overflow:auto;
      background:#fafafa;
      border:1px solid #eee;
      padding:6px 8px;
      white-space:pre-wrap;
      font:14px/1.4 monospace;
    }
    .seq-box.loading{color:#888}
  </style>
</head>
<body>
  <h1>Structure + Sequence Gallery</h1>
  <div id="grid"></div>

<script>
  /* ===== 路径常量 ===== */
  const CSV_URL   = 'https://raw.githubusercontent.com/HiFutureWH/RBP/main/list/File_Name_List.csv';
  const BASE_PDB  = 'https://raw.githubusercontent.com/HiFutureWH/RBP/main/interaction_structures/';
  const BASE_FASTA= 'https://raw.githubusercontent.com/HiFutureWH/RBP/main/sequence/';

  fetch(CSV_URL).then(r=>r.text()).then(txt=>{
    const files = txt.trim().split(/\r?\n/).slice(1).filter(Boolean);
    const grid  = document.getElementById('grid');

    files.forEach(name=>{
      const id   = name.replace(/\.\w+$/,'');          // 去掉扩展名
      const pdb  = BASE_PDB   + name;
      const fasta= BASE_FASTA + id + '.fasta';

      /* === DOM 结构 === */
      const row   = document.createElement('div'); row.className='row';

      /* ID 标签 */
      const tag   = document.createElement('div');
      tag.className = 'id-tag';
      tag.textContent = id;
      row.appendChild(tag);

      /* 结构视窗 */
      const ifr   = document.createElement('iframe');
      ifr.loading='lazy';
      ifr.src = 'viewer-frame.html?url=' + encodeURIComponent(pdb);
      row.appendChild(ifr);

      /* FASTA 序列框 */
      const box   = document.createElement('pre');
      box.className='seq-box loading';
      box.textContent='Loading '+id+'.fasta …';
      row.appendChild(box);

      grid.appendChild(row);

      /* 拉取 FASTA 填充 */
      fetch(fasta)
        .then(r=>r.ok ? r.text() : '⚠️  not found')
        .then(t=>{
          box.classList.remove('loading');
          box.textContent = t;
        })
        .catch(e=>{
          box.classList.remove('loading');
          box.textContent = '⚠️  fetch error';
          console.error(e);
        });
    });
  }).catch(e=>{
    console.error(e);
    alert('CSV 读取失败');
  });
</script>
</body>
</html>
