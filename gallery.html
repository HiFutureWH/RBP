<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Structure + FASTA Gallery</title>

  <style>
    :root { --view-h: 360px; --view-w: 420px; }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:sans-serif}
    h1{margin:16px}
    #grid{
      display:flex;
      flex-direction:column;
      gap:20px;
      padding:0 16px 32px;
    }
    /* 单元格：左右两栏 */
    .row{
      display:flex;
      gap:16px;
      align-items:flex-start;
      border:1px solid #ddd;
      border-radius:6px;
      padding:10px;
    }
    iframe{
      width:var(--view-w);
      height:var(--view-h);
      border:0;
      flex-shrink:0;
    }
    .seq-box{
      flex:1;
      max-height:var(--view-h);
      overflow:auto;
      background:#fafafa;
      border:1px solid #eee;
      padding:6px 8px;
      white-space:pre-wrap;
      font-family:monospace;
      font-size:14px;
    }
    .seq-box.loading{color:#888}
  </style>
</head>
<body>
  <h1>Structure + Sequence Gallery</h1>
  <div id="grid"></div>

<script>
  /* === 路径常量 === */
  const CSV_URL   = 'https://raw.githubusercontent.com/HiFutureWH/RBP/main/list/File_Name_List.csv';
  const BASE_PDB  = 'https://raw.githubusercontent.com/HiFutureWH/RBP/main/interaction_structures/';
  const BASE_FASTA= 'https://raw.githubusercontent.com/HiFutureWH/RBP/main/sequence/';

  /* 读 CSV → 每行建一个 row */
  fetch(CSV_URL).then(r=>r.text()).then(text=>{
    const files = text.trim().split(/\r?\n/).slice(1).filter(Boolean);
    const grid  = document.getElementById('grid');

    files.forEach(name=>{
      /* id = 去掉扩展名 */
      const id  = name.replace(/\.\w+$/,'');
      const pdb = BASE_PDB   + name;
      const fas = BASE_FASTA + id + '.fasta';

      /* 构造 DOM */
      const row  = document.createElement('div');  row.className='row';

      const ifr  = document.createElement('iframe');
      ifr.loading='lazy';
      ifr.src = 'viewer-frame.html?url=' + encodeURIComponent(pdb);
      row.appendChild(ifr);

      const seq  = document.createElement('pre');
      seq.className='seq-box loading';
      seq.textContent='Loading ' + id + '.fasta …';
      row.appendChild(seq);

      grid.appendChild(row);

      /* 拉取 fasta 并填充 */
      fetch(fas)
        .then(r => r.ok ? r.text() : '⚠️  not found')
        .then(txt=>{
          seq.classList.remove('loading');
          seq.textContent = txt;
        })
        .catch(e=>{
          seq.classList.remove('loading');
          seq.textContent = '⚠️  fetch error';
          console.error(e);
        });
    });
  }).catch(e=>{
    console.error(e);
    alert('CSV 读取失败');
  });
</script>
</body>
</html>
