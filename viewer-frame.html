<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDB Preview — Rainbow + Spin</title>

  <!-- PDBe Mol* 插件 (自动包含 Mol*) -->
  <script src="https://cdn.jsdelivr.net/npm/pdbe-molstar@latest/build/pdbe-molstar-plugin.js"></script>
  <link  rel="stylesheet"
         href="https://cdn.jsdelivr.net/npm/pdbe-molstar@latest/build/pdbe-molstar.css"/>

  <style>
    html,body{margin:0;height:100%;width:100%}
    #viewer{width:100%;height:100%}
  </style>
</head>
<body>
  <div id="viewer"></div>

<script>
  /* 1 — 拿到 ?url=… */
  const pdbUrl = new URLSearchParams(location.search).get('url');
  if (!pdbUrl) { document.body.textContent = 'no file url'; throw ''; }

  /* 2 — 创建插件实例并加载结构 */
  const plugin = new PDBeMolstarPlugin();

  plugin.render('viewer', {
    customData : { url: pdbUrl, format: 'pdb' },  // 加载 PDB
    ui         : false                            // 不要侧栏
  }).then(async () => {

    /* 3 — Cartoon + Chain Rainbow */
    await plugin.visual.updateRepresentation({
      type : 'cartoon',
      color: { name: 'chain-id', params: {} }
    });

    /* 4 — 相机居中、模型填充 80% 视窗 */
    plugin.canvas.setProps({
      camera: {
        resetClipping: true,
        snapshot     : { radiusFactor: 1.2 }
      }
    });

    /* 5 — 自动旋转（低速） */
    // plugin.visual.toggleSpin(true) 已内置; 默认为 0.6 rad/s，可调
    plugin.visual.toggleSpin(true);
    plugin.visual.setSpinSpeed(0.2);   // 自定义转速 (rad/s)

    /* 6 — 去掉底部序列条与 logo */
    document.querySelectorAll(
      '.msp-sequence-wrapper, .msp-brand'
    ).forEach(el => el.remove());
  });
</script>
</body>
</html>
