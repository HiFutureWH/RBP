<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDB Viewer (preset camera + rainbow)</title>

  <!-- PDBe-Mol* 插件 -->
  <script src="https://cdn.jsdelivr.net/npm/pdbe-molstar@latest/build/pdbe-molstar-plugin.js"></script>
  <link  rel="stylesheet"
         href="https://cdn.jsdelivr.net/npm/pdbe-molstar@latest/build/pdbe-molstar.css"/>

  <style>
    html,body{margin:0;height:100%;width:100%}
    #v{width:100%;height:100%}
  </style>
</head>
<body>
  <div id="v"></div>

<script>
  /* 从 ?url=... 获取 PDB 地址 */
  const url = new URLSearchParams(location.search).get('url');
  if(!url){ document.body.textContent = 'no file url'; throw ''; }

  /* 创建并渲染 */
  const plugin = new PDBeMolstarPlugin();

  plugin.render('v', {
    customData : { url, format:'pdb' },
    ui         : false                 // 隐藏左边 panel
  }).then(async () => {
    /* ──① 预设相机：让模型占视窗 ~80%，视角为整体中心 ── */
    plugin.canvas.setProps({
      camera: { resetClipping:true, snapshot:{ radiusFactor:1.2 } }
    });

    /* ──② 改成 Cartoon + 彩虹链条配色 ───────────────── */
    await plugin.visual.updateRepresentation({
      type : 'cartoon',
      color: { name:'chain-id', params:{} }   // Mol* 里“chain rainbow”
    });

    /* ──③ 去掉底部序列条与 Logo ─────────────────────── */
    document
      .querySelectorAll('.msp-sequence-wrapper, .msp-brand')
      .forEach(el => el.remove());
  });
</script>
</body>
</html>
